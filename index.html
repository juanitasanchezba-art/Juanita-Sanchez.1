<!-- WIDGET COMPLETO: Daju IA Chat -->
<div id="daju-chat-container">

<style>
  #chat-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #a98bff;
    color: white;
    border: none;
    padding: 16px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 22px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 999999;
  }

  #chat-window {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 320px;
    height: 430px;
    background: #ffffff;
    border: 1px solid #e5dbff;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    display: none;
    flex-direction: column;
    z-index: 999999;
  }

  #chat-header {
    background: #a98bff;
    color: white;
    padding: 12px;
    font-weight: bold;
    border-radius: 12px 12px 0 0;
    text-align: center;
    font-size: 1.1rem;
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 0.95rem;
  }

  .msg-user {
    background: #f1eaff;
    padding: 8px;
    margin: 6px 0;
    border-radius: 8px;
    text-align: right;
  }

  .msg-bot {
    background: #f6f3ff;
    padding: 8px;
    margin: 6px 0;
    border-radius: 8px;
  }

  #chat-input-container {
    padding: 10px;
    display: flex;
    border-top: 1px solid #ddd;
  }

  #chat-input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  #send-btn {
    background: #a98bff;
    color: white;
    border: none;
    padding: 8px 12px;
    margin-left: 6px;
    border-radius: 8px;
    cursor: pointer;
  }
</style>

<button id="chat-button">ðŸ’¬</button>

<div id="chat-window">
  <div id="chat-header">Daju IA</div>
  <div id="chat-messages"></div>
  
  <div id="chat-input-container">
    <input type="text" id="chat-input" placeholder="Escribe un mensaje..." />
    <button id="send-btn">Enviar</button>
  </div>
</div>

<script>
  (function(){
    const chatBtn = document.getElementById("chat-button");
    const chatWindow = document.getElementById("chat-window");
    const sendBtn = document.getElementById("send-btn");
    const chatInput = document.getElementById("chat-input");
    const chatMessages = document.getElementById("chat-messages");

    let firstOpen = true;

    function addMessage(text, sender) {
      const div = document.createElement("div");
      div.className = sender === "user" ? "msg-user" : "msg-bot";
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    chatBtn.onclick = () => {
      const closed = chatWindow.style.display === "none" || chatWindow.style.display === "";
      chatWindow.style.display = closed ? "flex" : "none";

      if (closed && firstOpen) {
        setTimeout(() => {
          addMessage("Hola ðŸ‘‹ Soy Daju IA. Â¿En quÃ© puedo ayudarte hoy?", "bot");
        }, 300);
        firstOpen = false;
      }
    };

    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;

      addMessage(message, "user");
      chatInput.value = "";

      try {
        const res = await fetch(
          "https://juanita.app.n8n.cloud/webhook/62af3e9c-1b85-4831-b6d2-25283f0a0538/chat",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
          }
        );

        const data = await res.json();
        addMessage(data.reply || "No recibÃ­ respuesta del servidor.", "bot");

      } catch (error) {
        addMessage("Hubo un error al conectar con Daju IA.", "bot");
      }
    }

    sendBtn.onclick = sendMessage;
    chatInput.addEventListener("keypress", e => {
      if (e.key === "Enter") sendMessage();
    });

  })();
</script>

</div>
<!-- FIN WIDGET -->
